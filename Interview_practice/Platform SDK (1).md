
### UPL

언리얼엔진에서 네이티브 코드와 설정을 통합하기 위한 XML 스크립트임. 주로 Android, iOS에서 사용되며 빌드시에 플랫폼별 자동적용 됨.

역할은
1. 네이티브 라이브러리 통합 (안드로이드 : AAR, iOS: Framework)
2. 플랫폼 설정
	* 안드로이드 권한, proguard 설정 등
	* iOS info.plist key-value 설정

### OAuth Flow

구글 로그인으로 플로우

1. 클라이언트는 구글 로그인 창으로 리다이렉트
2. 유저는 로그인하고 인가서버는 클라이언트에게 인가코드를 넘겨줌
3. 클라이언트는 백엔드에게 인가코드를 넘겨준다.
4. 백엔드는 클라이언트에게 받은 인가코드로 구글 인가서버에서 검증
5. 백엔드는 구글 인가서버로부터 액세스 토큰을 발급받음.
6. 백엔드는 이 구글 엑세스 토큰으로 구글 리소스 서버에 접속할 수 있음
7. 백엔드는 클라이언트에게 엑세스 토큰을 넘겨줌 (이 액세스 토큰은 구글 엑세스 토큰이 보통 아니고 자체 백엔드 엑세스 토큰임)


### IAP Flow

#### iOS IAP

1. 앱스토어 커넥트에서 상품 등록 (product id, 소모성, 갱신형 etc...)
2. product id로 상품 정보 요청
3. 사용자 결제 요청
4. Apple 결제 처리 및 영수증 생성
5. 결제 결과 처리
6. 클라이언트는 기본적인 영수증 검증을 하기
	1. 영수증 여부 검사 (데이터 존재 유무)
	2. 앱 무결성 (앱 번들 아이디를 확인한다든지 등.)
	3. 거래 정보 기본 확인 (transaction id, prouduct id)

7. 거래 완료 처리 (성공이든, 실패든 일단 transaction은 완료 처리 해야함)
	1. 거래 완료 처리를 안하면 계속 pending 상태로 남아 있게됨. 그러면 중복 결제 가능성 있음
	2. 사용자는 결제를 완료 했는데 결제 프로세스가 실행된다면 유저경험이 매우 떨어진다!!

8. 백엔드로 영수증 보냄 (영수증 검증은 백엔드에서 진행하길 적극 권장)

#### 안드로이드 IAP

1. 구글 결제 서비스 연결 (Start Connection)
2. 결제 서비스 연결 확인
3. 상품 조회 - Qurey Sku details
4. 구매시작 - Launch Billing Flow
5. 사용자 결제
6. 구매 후 처리
	1. Acknowledge Purchase
	2. 백엔드 검증 로직 (Purchase Token를 백엔드로 보내야함)
	3. Consume
7. 상태 확인

이렇게 볼 때, iOS는 사용자 경험을 좀 더 우선시 하는 거 같고, 안드로이드는 부정 구매에 대한 방어에 초점이 맞춰져 있는 거 같다.

