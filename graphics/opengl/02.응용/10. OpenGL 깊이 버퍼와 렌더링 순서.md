
## 1. 깊이 버퍼 (Z-buffer) 기본 개념

깊이 버퍼는 3D 그래픽스에서 어떤 물체가 다른 물체를 가리는지 결정하는 핵심 메커니즘이다.

- **작동 원리**: 각 픽셀마다 카메라로부터의 거리(Z값)를 저장
- **범위**: 일반적으로 [0.0, 1.0] (0.0은 near plane, 1.0은 far plane)
- **정밀도**: 일반적으로 16비트, 24비트 또는 32비트 (24비트가 가장 일반적)
- **분포**: 비선형적 분포 - 가까운 거리에서 정밀도가 높고, 먼 거리에서는 정밀도가 낮음

## 2. 깊이 버퍼 설정 방법

### 기본 설정
```cpp
// 깊이 테스트 활성화
glEnable(GL_DEPTH_TEST);

// 깊이 테스트 비교 함수 설정 (기본값은 GL_LESS)
glDepthFunc(GL_LESS);  // 새 픽셀의 깊이 값이 작을 때(더 가까울 때) 통과
```

### 깊이 버퍼 초기화
```cpp
// 렌더링 루프에서 매 프레임마다 색상 버퍼와 깊이 버퍼를 함께 초기화
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
```

### 깊이 버퍼 쓰기 제어
```cpp
// 깊이 버퍼 쓰기 활성화 (기본값)
glDepthMask(GL_TRUE);

// 깊이 버퍼 쓰기 비활성화 (투명 오브젝트 그릴 때 유용)
glDepthMask(GL_FALSE);
```

### 깊이 비교 함수 옵션
- `GL_LESS`: 새 값이 작을 때 통과 (기본값)
- `GL_LEQUAL`: 새 값이 작거나 같을 때 통과
- `GL_GREATER`: 새 값이 클 때 통과
- `GL_GEQUAL`: 새 값이 크거나 같을 때 통과
- `GL_EQUAL`: 새 값이 같을 때만 통과
- `GL_NOTEQUAL`: 새 값이 다를 때 통과
- `GL_ALWAYS`: 항상 통과
- `GL_NEVER`: 절대 통과하지 않음

## 3. 깊이 버퍼 정밀도와 Z-fighting

Z-fighting은 두 물체가 거의 같은 깊이에 있을 때 깜빡이는 현상입니다.
### 원인

- 깊이 버퍼의 제한된 정밀도
- near plane과 far plane 사이의 거리가 너무 큰 경우
- 특히 먼 거리에서 정밀도가 낮아지는 비선형 분포로 인해 발생

### 해결 방법

- **near/far plane 비율 줄이기**: 시야 범위를 필요한 만큼만 설정
```cpp
glm::mat4 projection = glm::perspective(glm::radians(45.0f), aspect_ratio, 0.1f, 100.0f);
```

- **높은 정밀도의 깊이 버퍼 사용**: 24비트 또는 32비트 깊이 버퍼 사용
- **물체 배치 조정**: 서로 다른 물체가 완전히 같은 깊이에 있지 않도록 약간 간격 두기
