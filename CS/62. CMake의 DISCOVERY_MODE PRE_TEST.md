

CMake와 GoogleTest의 협력

gtest_discover_tests 명령어는 빌드 시점(Post-Build)에 작동

1. 컴파일러가 app 실행 파일을 만듭니다 (Link 단계).
2. 즉시 CMake가 이 실행 파일을 실행합니다 (./test-app --gtest_list_tests)
3. 실행 결과로 나오는 테스트 목록(Test Case List)을 파싱해서 CTest에 등록합니다.


Subprocess killed 에러는 2번 단계에서 발생함.

macOS나 일부 CI 환경, 혹은 크로스 컴파일 환경에서는 방금 막 만들어진 실행 파일을 빌드 프로세스 중에 실행하는 것을 차단하거나 실패하는 경우가 많음.

- macOS 보안 - 서명되지 않은 바이너리가 Xcode 빌드 스크립트 내부에서 실행될 때 OS가 차단할 수 있음
- 환경 변수 - 실행에 필요한 라이브러리 경로(DLL/DyLib)가 빌드 시점에는 설정되지 않았을 수 있음
- 아키텍처 - 예시로 x86 호스트에서 ARM 바이너리를 빌드한 경우 실행 자체가 불가능할 수 있음


`DISCOVERY_MODE PRE_TEST` 옵션은 테스트 목록을 수집하는 시점을 실제 테스트를 돌릴 때(CTest 실행 시점)로 미룸

1. 빌드 단계에서는 실행 파일을 만들기만 하고 끝냄 (실행 X)
2. 개발자가 ctest 명령어를 입력합니다.
3. 실행 파일을 실행하여(--gtest_list_tests) 테스트 목록을 가져오고, 바로 테스트를 수행

이렇게 하면 빌드 시스템(Xcode/Make)과 실행 환경을 분리할 수 있고 아까와 같은 Subprocess killed나 환경 변수 문제를 깔끔하게 피할 수 있음

`DISCOVERY_MODE PRE_TEST` 옵션은 CMake 3.18에서부터 지원