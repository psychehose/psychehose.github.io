<!DOCTYPE html> <html lang="en"><head>
<title>드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )</title>
<base href="..">
<meta name="pathname" content="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html">
<meta name="description" content="psychehose.github.io - 드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )">
<meta property="og:title" content="드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )">
<meta property="og:description" content="psychehose.github.io - 드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )">
<meta property="og:type" content="website">
<meta property="og:url" content="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html">
<meta property="og:image" content="https://blog.kakaocdn.net/dn/b19Hpt/btr3XzquX1H/gL1rnkKKReXJ3e2dikVml1/img.gif">
<meta property="og:site_name" content="psychehose.github.io"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><meta charset="UTF-8"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:4px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#layout{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math:not(.math-inline),table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const l=await fetch(e);if(!l.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await l.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let l=document.createRange().createContextualFragment(o),n=Array.from(l.children);for(let e of n)e?.classList?.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e?.classList?.remove("hide")}),10);t.before(l),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(l){let n=o[l],c=l+1;n?(n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(c),l<o.length&&n.addEventListener("load",(()=>e(c)))):l<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager mod-macos is-hidden-frameless native-scrollbars show-inline-title show-ribbon show-view-header minimal-default-light minimal-default-dark minimal-readable colorful-headings links-int-on links-ext-on full-width-media trim-cols sidebar-tabs-default is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="layout"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles">mjx-msub{display:inline-block;text-align:left}mjx-texatom{display:inline-block;text-align:left}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c1D43D.TEX-I::before{padding:.683em .633em .022em 0;content:"J"}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c2F::before{padding:.75em .5em .25em 0;content:"/"}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-msup{display:inline-block;text-align:left}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;font-size-adjust:none;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-mn{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("site-lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("site-lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("site-lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("site-lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("site-lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("site-lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("site-lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("site-lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("site-lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("site-lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("site-lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("site-lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("site-lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("site-lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("site-lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("site-lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("site-lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("site-lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("site-lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("site-lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("site-lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("site-lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}</style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="드래그가_가능한_BottomSheet를_만들어보자(DraggableBottomSheet_)_0">드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h3"><h3 data-heading="들어가기 전에" dir="auto" class="heading" id="들어가기_전에_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>들어가기 전에</h3></div><div class="el-p"><p dir="auto">&nbsp;Ounce를 개발할 때, 버튼을 누르면 밑에서 present modal 방식으로 올라오는 뷰를 만든 적이 있습니다. 다만 그때 시간이 촉박해서 애플이 기본적으로 제공하는 방식으로 구현했습니다.</p></div><div class="el-p"><p dir="auto">잠깐 코드를 가져와보겠습니다.</p></div><div class="el-pre"><pre><code data-line="0">let targetVC = ViewController()
targetVC.modalPresentationStyle = .popover
self.present(targetVC, animated: true, completion: nil)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">이제는 좀 더 나아가서 드래그가 가능하고 이전의 뷰가 백그라운드 처리가 되어 있는 뷰를 만들어보겠습니다.</p></div><div class="el-h3"><h3 data-heading="구현" dir="auto" class="heading" id="구현_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>구현</h3></div><div class="el-p"><p dir="auto">&nbsp;뷰의 전환은 ViewController → BottomCardViewController입니다.</p></div><div class="el-p"><p dir="auto">먼저 구현에 필요한 extension을 추가하겠습니다. 화면 전환을 할 때 현재 화면(ViewController)의 스냅샷을 찍어서 화면 전환한 후 (BottomSheetViewController)의 배경화면으로 사용할 겁니다. 그리고 ViewController에서 사용할 화면전환 함수를 만들 것인데 저는 tapGestureRecognizer를 이용하도록 할게요.</p></div><div class="el-pre"><pre><code data-line="0">// UIView+Snapshot.swift

extension UIView  {
    // render the view within the view's bounds, then capture it as image
  func asImage() -&gt; UIImage {
    let renderer = UIGraphicsImageRenderer(bounds: bounds)
    return renderer.image(actions: { rendererContext in
        layer.render(in: rendererContext.cgContext)
    })
  }
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre><code data-line="0">//UIViewController.swift

let tapGesture = UITapGestureRecognizer(target: self,
					action: #selector(self.tapImageView(_:)))

@objc func tapImageView(_ sender:UITapGestureRecognizer) {
        let bottomCardViewController = BottomCardViewController()
        bottomCardViewController.modalPresentationStyle = .fullScreen
        bottomCardViewController.backgroundImage = view.asImage()
        
        self.present(bottomCardViewController, animated: false, completion: nil)
    }
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">여기까지 작성하면 ViewController에서 해야 할 일은 끝났습니다.</p></div><div class="el-p"><p dir="auto">이제 BottomCardViewController를 만들겠습니다. BottomCardViewController는 다음과 같은 UIComponet와 Property들이 필요하다.</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>배경을 투명하게 만들어 주는&nbsp;<strong>dimmerView</strong>: UIView</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>cardView</strong>: UIView</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>backgroundImage: UIImage - 스냅샷 이미지</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>스냅샷으로 넘겨받은 이미지를 담는 UIImageView</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><strong>cardViewTopConstraints</strong>: NSLayoutConstraint - 드래그를 할 때 이 값의 변화에 따라 실제로 뷰가 움직입니다.</li>
</ul></div><div class="el-p"><p dir="auto">처음에 화면 전환을 할 때, 아래에서부터 cardView가 올라와야 하기 때문에 viewDidLoad에 다음과 같이 레이아웃을 잡았습니다. cardView의 Top Constraint를 잡은 것을 보면 카드뷰의 Top이 우리가 화면에서 보는 뷰 바로 아래에 위치하는 것을 알 수 있습니다.</p></div><div class="el-pre"><pre><code data-line="0">func setupViews() {
	if let safeAreaHeight = UIApplication.shared.windows.first?
            .safeAreaLayoutGuide.layoutFrame.size.height,
           let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
            cardViewTopConstraint = cardView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor,
                                                                  constant: safeAreaHeight + bottomPadding)
        }
        
        cardView.bottomAnchor.constraint(equalTo: view.bottomAnchor).isActive = true
        cardView.leadingAnchor.constraint(equalTo: view.leadingAnchor).isActive = true
        cardView.trailingAnchor.constraint(equalTo: view.trailingAnchor).isActive = true
        NSLayoutConstraint.activate([cardViewTopConstraint])
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">그러고 나서 viewDidAppear에서&nbsp;<strong>카드뷰를 올라오게 하는 함수</strong>를 사용하면 되겠네요.</p></div><div class="el-p"><p dir="auto">카드뷰를 올라오게 하는 함수 showCard()를 어떻게 구현하면 될까요?</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>dimmerView의 alpha 값을 조절</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>cardView의 topConstraint의 값을 조절</li>
</ul></div><div class="el-pre"><pre><code data-line="0">private func showCard() {
    self.view.layoutIfNeeded()
    if
      let safeAreaHeight = UIApplication
        .shared
        .windows.first?
        .safeAreaLayoutGuide
        .layoutFrame
        .size
        .height,
      let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
      cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding) / 2
    }

    let showCard = UIViewPropertyAnimator(duration: 1, curve: .easeIn, animations: {
      self.view.layoutIfNeeded()
    })

    showCard.addAnimations({
      self.dimmerView.alpha = 0.7
    })
    showCard.startAnimation()
  }
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding) / 2를 통해서&nbsp; 카드뷰의 위치를 중간쯤으로 위치시켰습니다. 이렇게 딱 끝나면 좋을 것 같은데 끝이 아닙니다. topConstraint의 값은 변했지만 UI 변화는 실시간으로 반영되지 않습니다. 저는 애니메이션을 주고 싶기 때문에 카드 뷰의 위치를 실시간으로 업데이트해주고 싶어요. 뷰의 위치를 업데이트하는 방법은 layoutIfNeeded()를 이용하는 것입니다. 저는 애니메이션을 실행시키는 여러 방법 중 하나인 UIViewPropertyAnimator를 사용해서 카드뷰 위치를 업데이트하겠습니다. 그리고 화면 Dim 처리 역시 UIViewPropertyAnimator에게 넘겨주겠습니다.</p></div><div class="el-p"><p dir="auto">이제는 바텀시트를 닫아주는 함수를 만들게요. showCard()를 이해했다면, 쉽게 알 수 있어요. 거의 똑같은 함수라서요. 차이점은 카드뷰가 내려갔을 때 BottomSheetViewControll를 dismiss 해주면 됩니다.</p></div><div class="el-pre"><pre><code data-line="0">private func hideAndDismiss() {
  self.view.layoutIfNeeded()
  if
    let window = UIApplication.shared.windows.first {
    let safeAreaHeight = window.safeAreaLayoutGuide.layoutFrame.size.height
    let bottomPadding = window.safeAreaInsets.bottom
    cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding)
  }
  let hideAndDismiss = UIViewPropertyAnimator(duration: 1, curve: .easeIn, animations: {
    self.view.layoutIfNeeded()
  })

  hideAndDismiss.addAnimations({
    self.dimmerView.alpha = 0.0
  })
  hideAndDismiss.addCompletion({ position in
    if position == .end {
      if(self.presentingViewController != nil) {
        self.dismiss(animated: false, completion: nil)
      }
    }
  })
  hideAndDismiss.startAnimation()
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">여기까지 완료 했으면, 다음과 같이 작동합니다. gif 변환 과정에서 바텀시트가 올라오는 모습이 좀 어색해졌네요.</p></div><div class="el-p"><p dir="auto"><img src="https://blog.kakaocdn.net/dn/b19Hpt/btr3XzquX1H/gL1rnkKKReXJ3e2dikVml1/img.gif" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div class="el-p"><p dir="auto">여기까지 구현한거면 큰 뼈대는 다 구현한 것이니 사실 다 만든 것이나 다름없다고 생각해요. 이제는 드래그가 가능하게 만들 겁니다.</p></div><div class="el-p"><p dir="auto">단순히 핸들 뷰를 만들고 이것을 드래그할 때 cardViewTopConstraint가 변하는 것을 구현하면 됩니다.</p></div><div class="el-p"><p dir="auto">어떤 것이든 상태가 있는 경우에는 대부분 Enum을 통해서 관리하는 것이 편하다고 생각해요. 그래서 cardView의 위치 또한 Enum으로 관리하도록 할게요.</p></div><div class="el-pre"><pre><code data-line="0">enum CardViewState {
        case expanded // Safe Area Top에서 30pt 떨어진 상태
        case normal // (Safe Area Height + Safe Area Bottom Inset) / 2
 }
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">expanded를 어떻게 처리할까요? 이미 구현했던 showCard를 재사용하면 될 것 같습니다. 그러기 위해서 showCard를 리팩토링 하겠습니다.&nbsp;showCard의 매개변수는 void인데 재사용을 위해서 atState: CardViewState를 매개변수로 추가하겠습니다.&nbsp;그리고나서 if문이나 switch문을 통해서 atState의 값에 따라 분기처리 하면 됩니다.</p></div><div class="el-pre"><pre><code data-line="0">private func showCard(atState: CardViewState = .normal) {
        self.view.layoutIfNeeded()
        
        if let safeAreaHeight = UIApplication.shared.windows.first?
            .safeAreaLayoutGuide.layoutFrame.size.height,
           let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
            
            if atState == .expanded {
                cardViewTopConstraint.constant = 30.0
            } else {
                cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding) / 2
            }
            cardPanStartingTopConstant = cardViewTopConstraint.constant
        }
        

        let showCard = UIViewPropertyAnimator(duration: 0.3, curve: .easeIn, animations: {
            self.view.layoutIfNeeded()
          })

        showCard.addAnimations({
            self.dimmerView.alpha = 0.7
          })
        showCard.startAnimation()

    }
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Card View를 드래그하기 위해서는, UIPanGestureRecognizer를 등록해야 합니다.</p></div><div class="el-p"><p dir="auto">GestureRecognizer는 사용자가 뷰에 행동을 취하는 것을 트랙킹 할 수 있도록 도와줍니다. 예를 들면 사용자가 뷰를 길게 터치하는 것, 뷰를 드래그하는 것들을 알 수 있고 그에 맞게 우리가 하고 싶은 행동(스크롤을 한다던가, 다른 뷰를 보여준다던가)을 취할 수 있게 됩니다.&nbsp;</p></div><div class="el-pre"><pre><code data-line="0">func panViewGesture() {
        let viewPan = UIPanGestureRecognizer(target: self, action: #selector(viewPanned(_: )))
        
        // iOS는 기본적으로 touch를 감지 (recode) 하기 전에 약간의 딜레이를 준다. 즉시 반응해야 하기 때문에 false
        viewPan.delaysTouchesBegan = false
        viewPan.delaysTouchesEnded = false
        cardView.addGestureRecognizer(viewPan)
        handleView.addGestureRecognizer(viewPan)
    }
    
    @objc func viewPanned(_ panRecognizer: UIPanGestureRecognizer) {
    	// 구현하면 될 것
    }
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">이제 viewPanned 함수를 구현해보도록 하겠습니다. UIPanGestureRecognize의 state라는 property를 이용하면 돼요. 이 state에 따라서 cardViewTopConstaraint를 변화시켜 주면 되겠죠?</p></div><div class="el-p"><p dir="auto">코드 구현에 앞서 각 state를 어떻게 구현해야 할 지에 대해서 생각해 봅시다.</p></div><div class="el-p"><p dir="auto">.began</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>드래그를 처음 시작했을 때의 topConstraint 값을 저장</li>
</ul></div><div class="el-p"><p dir="auto">.changed</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>드래그를 하고 있는 상태 (cardViewTopConstarint가 바뀌는 중)</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>topConstraint가 expanded mode(30) 보다 작아서는 안됨</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>드래그를 따라서, dimmer View의 alpha 값 조절</li>
</ul></div><div class="el-p"><p dir="auto">.ended</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>드래그가 끝난 후 액션 처리</li>
</ul></div><div class="el-p"><p dir="auto">그리고 추가적으로 만약 사용자가 아래로 드래그를 빠르게 했을 때 (Snap) 바텀시트를 닫으면 사용자 관점에서 엄청 편할 거예요. 얼마나 빠르게&nbsp;뷰를 드래그했는지 velocity라는 변수를 통해서 알 수 있습니다. 그래서 이것을 감지한다면 바텀시트를 닫아주면 돼요.</p></div><div class="el-pre"><pre><code data-line="0">@objc func viewPanned(_ panRecognizer: UIPanGestureRecognizer) {
  let translation = panRecognizer.translation(in: view)
  let velocity = panRecognizer.velocity(in: view)

  switch panRecognizer.state {
  case .began:
    cardPanStartingTopConstant = cardViewTopConstraint.constant

  case .changed:
    if cardPanStartingTopConstant + translation.y &gt; 30.0 {
      cardViewTopConstraint.constant = cardPanStartingTopConstant + translation.y
    }

  case .ended:
    if velocity.y &gt; 1500.0 {
      hideAndDismiss()
      return
    }


    if
      let safeAreaHeight = UIApplication
        .shared.windows
        .first?
        .safeAreaLayoutGuide
        .layoutFrame
        .size.height,
       let bottomPadding = UIApplication.
        shared.windows.
        first?.
        safeAreaInsets.
        bottom {

      if cardViewTopConstraint.constant &lt; (safeAreaHeight + bottomPadding) * 0.25 {
        showCard(atState: .expanded)
      } else if cardViewTopConstraint.constant &lt; safeAreaHeight - 70 {
        showCard(atState: .normal)
      } else {
        hideAndDismiss()
      }
    }
  default:
    break
  }
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">여기까지 따라오셨으면, 다음과 같은 결과물을 얻을 수 있습니다.</p></div><div class="el-p"><p dir="auto"><img src="https://blog.kakaocdn.net/dn/K8K6s/btr3ICC7PYS/9aMTgKNES93blUUkqi2tC0/img.gif" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div class="el-h3"><h3 data-heading="전체코드 및 레퍼런스" dir="auto" class="heading" id="전체코드_및_레퍼런스_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>전체코드 및 레퍼런스</h3></div><div class="el-pre"><pre><code data-line="0">//
//  BottomCardViewController.swift
//  DraggableBottomCard
//
//  Created by psychehose on 2021/06/19.
//

import UIKit

class BottomCardViewController: UIViewController {
    
    enum CardViewState {
        case expanded
        case normal
    }
    var cardViewState: CardViewState = .normal
    
    private var imageView: UIImageView = {
        let imageView = UIImageView()
        imageView.translatesAutoresizingMaskIntoConstraints = false
        return imageView
    }()

    var dimmerView: UIView = {
        let dimmerView = UIView()
        dimmerView.alpha = 0.0
        dimmerView.backgroundColor = .gray
        dimmerView.translatesAutoresizingMaskIntoConstraints = false
        return dimmerView
    }()
    
    var cardView: UIView = {
        let cardView = UIView()
        cardView.translatesAutoresizingMaskIntoConstraints = false
        cardView.backgroundColor = .white
        cardView.clipsToBounds = true
        cardView.layer.cornerRadius = 10.0
        cardView.layer.maskedCorners = [.layerMinXMinYCorner, .layerMaxXMinYCorner]
        return cardView
    }()
    
    var handleView: UIView = {
        let handleView = UIView()
        handleView.layer.cornerRadius = 3.0
        handleView.clipsToBounds = true
        handleView.translatesAutoresizingMaskIntoConstraints = false
        handleView.backgroundColor = .gray
        return handleView
    }()
    var cardViewTopConstraint: NSLayoutConstraint!
    var cardPanStartingTopConstant: CGFloat = 30.0

    var backgroundImage: UIImage?



    override func viewDidLoad() {
        super.viewDidLoad()
        view.backgroundColor = .white
        imageView.image = backgroundImage
        configureLayout()
        tapBackgroundImageGesture()
        panViewGesture()
    }
    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
          showCard()
    }

    
}
    // MARK: - Gesture

extension BottomCardViewController {
    func tapBackgroundImageGesture() {
        let tapGesture = UITapGestureRecognizer(target: self, action: #selector(tapImageView(_: )))
        imageView.addGestureRecognizer(tapGesture)
        imageView.isUserInteractionEnabled = true
    }

    @objc func tapImageView(_ sender: UITapGestureRecognizer) {
        hideAndDismiss()
    }

    func panViewGesture() {
        let viewPan = UIPanGestureRecognizer(target: self, action: #selector(viewPanned(_: )))
        
        // iOS는 기본적으로 touch를 감지 (recode) 하기 전에 약간의 딜레이를 준다. 즉시 반응해야 하기 때문에 false
        viewPan.delaysTouchesBegan = false
        viewPan.delaysTouchesEnded = false
        cardView.addGestureRecognizer(viewPan)
        handleView.addGestureRecognizer(viewPan)
    }

    @objc func viewPanned(_ panRecognizer: UIPanGestureRecognizer) {
        let translation = panRecognizer.translation(in: view)
        let velocity = panRecognizer.velocity(in: view)
        
        switch panRecognizer.state {
        case .began:
            cardPanStartingTopConstant = cardViewTopConstraint.constant
        case .changed:
            if cardPanStartingTopConstant + translation.y &gt; 30.0 {
                cardViewTopConstraint.constant = cardPanStartingTopConstant + translation.y
            }
            
            self.dimmerView.alpha =
                dimmerAlphaWithTopConstant(value: cardViewTopConstraint.constant)
            
            
        case .ended:
            if velocity.y &gt; 1500.0 {
                hideAndDismiss()
                return
            }
            
            
            if let safeAreaHeight = UIApplication.shared.windows.first?
                .safeAreaLayoutGuide.layoutFrame.size.height,
               let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
                
                if cardViewTopConstraint.constant &lt; (safeAreaHeight + bottomPadding) * 0.25 {
                    showCard(atState: .expanded)
                    
                } else if cardViewTopConstraint.constant &lt; safeAreaHeight - 70 {
                    showCard(atState: .normal)
                } else {
                    hideAndDismiss()
                }
            }
            
        default:
            break
        }
        
    }
}


    // MARK: - UILayout

extension BottomCardViewController {

    func configureLayout() {
        view.addSubview(imageView)
        imageView.addSubview(dimmerView)
        view.addSubview(cardView)
        view.addSubview(handleView)
        
        imageView.topAnchor.constraint(equalTo: view.topAnchor).isActive = true
        imageView.bottomAnchor.constraint(equalTo: view.bottomAnchor).isActive = true
        imageView.leadingAnchor.constraint(equalTo: view.leadingAnchor).isActive = true
        imageView.trailingAnchor.constraint(equalTo: view.trailingAnchor).isActive = true
        
        dimmerView.topAnchor.constraint(equalTo: imageView.topAnchor).isActive = true
        dimmerView.bottomAnchor.constraint(equalTo: imageView.bottomAnchor).isActive = true
        dimmerView.leadingAnchor.constraint(equalTo: imageView.leadingAnchor).isActive = true
        dimmerView.trailingAnchor.constraint(equalTo: imageView.trailingAnchor).isActive = true
        
        
        if let safeAreaHeight = UIApplication.shared.windows.first?
            .safeAreaLayoutGuide.layoutFrame.size.height,
           let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
            cardViewTopConstraint = cardView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor,
                                                                  constant: safeAreaHeight + bottomPadding)
        }
        
        cardView.bottomAnchor.constraint(equalTo: view.bottomAnchor).isActive = true
        cardView.leadingAnchor.constraint(equalTo: view.leadingAnchor).isActive = true
        cardView.trailingAnchor.constraint(equalTo: view.trailingAnchor).isActive = true
        NSLayoutConstraint.activate([cardViewTopConstraint])
        
        handleView.centerXAnchor.constraint(equalTo: cardView.centerXAnchor).isActive = true
        handleView.widthAnchor.constraint(equalToConstant: 60).isActive = true
        handleView.heightAnchor.constraint(equalToConstant: 6).isActive = true
        handleView.bottomAnchor.constraint(equalTo: cardView.topAnchor, constant: -10).isActive = true
    }
    
}

extension BottomCardViewController {
    private func showCard(atState: CardViewState = .normal) {
        self.view.layoutIfNeeded()
        
        if let safeAreaHeight = UIApplication.shared.windows.first?
            .safeAreaLayoutGuide.layoutFrame.size.height,
           let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
            
            if atState == .expanded {
                cardViewTopConstraint.constant = 30.0
            } else {
                cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding) / 2
            }
            cardPanStartingTopConstant = cardViewTopConstraint.constant
        }
        

        let showCard = UIViewPropertyAnimator(duration: 0.3, curve: .easeIn, animations: {
            self.view.layoutIfNeeded()
          })

        showCard.addAnimations({
            self.dimmerView.alpha = 0.7
          })
        showCard.startAnimation()

    }
    private func hideAndDismiss() {
        self.view.layoutIfNeeded()
        if let safeAreaHeight = UIApplication.shared.windows.first?
            .safeAreaLayoutGuide.layoutFrame.size.height,
           let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom {
            cardViewTopConstraint.constant = (safeAreaHeight + bottomPadding)
        }
        let hideAndDismiss = UIViewPropertyAnimator(duration: 0.3, curve: .easeIn, animations: {
            self.view.layoutIfNeeded()
          })
        
        hideAndDismiss.addAnimations({
            self.dimmerView.alpha = 0.0
          })
        hideAndDismiss.addCompletion({ position in
            if position == .end {
              if(self.presentingViewController != nil) {
                self.dismiss(animated: false, completion: nil)
              }
            }
          })
        hideAndDismiss.startAnimation()
    }
}

extension BottomCardViewController {
    private func dimmerAlphaWithTopConstant(value: CGFloat) -&gt; CGFloat {
        let fullDimAlpha: CGFloat = 0.7
        
        guard let safeAreaHeight = UIApplication.shared.windows.first?
                .safeAreaLayoutGuide.layoutFrame.size.height,
              let bottomPadding = UIApplication.shared.windows.first?.safeAreaInsets.bottom else {
            return fullDimAlpha
        }
        
        let fullDimPosition = (safeAreaHeight + bottomPadding) / 2.0
        
        let noDimPosition = safeAreaHeight + bottomPadding
        
        if value &lt; fullDimPosition {
            return fullDimAlpha
        }
        if value &gt; noDimPosition {
            return 0.0
        }
        return fullDimAlpha * 1 - ((value - fullDimPosition) / fullDimPosition)
    }
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="https://fluffy.es/facebook-draggable-bottom-card-modal-2/" rel="noopener nofollow" class="external-link is-unresolved" href="https://fluffy.es/facebook-draggable-bottom-card-modal-2/" target="_self">https://fluffy.es/facebook-draggable-bottom-card-modal-1/</a></p></div><div class="el-p"><p dir="auto">&nbsp;[Replicating Facebook's Draggable Bottom Card using Auto Layout - Part 2/2</p></div><div class="el-p"><p dir="auto">In Part 1, we have managed to implement the show and hide card animation when user tap on button or the dimmer view. In this part, we are going to implement the card dragging animation. This post assume that you already knew about Auto Layout and Delegate.</p></div><div class="el-p"><p dir="auto">fluffy.es](<a rel="noopener nofollow" class="external-link is-unresolved" href="https://fluffy.es/facebook-draggable-bottom-card-modal-2/" target="_self">https://fluffy.es/facebook-draggable-bottom-card-modal-2/</a>)</p></div><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link is-unresolved" href="https://fluffy.es/facebook-draggable-bottom-card-modal-2/" target="_self">https://fluffy.es/facebook-draggable-bottom-card-modal-2/</a></p></div><div class="el-p"><p dir="auto">&nbsp;[Replicating Facebook's Draggable Bottom Card using Auto Layout - Part 2/2</p></div><div class="el-p"><p dir="auto">In Part 1, we have managed to implement the show and hide card animation when user tap on button or the dimmer view. In this part, we are going to implement the card dragging animation. This post assume that you already knew about Auto Layout and Delegate.</p></div><div class="el-p"><p dir="auto">fluffy.es](<a rel="noopener nofollow" class="external-link is-unresolved" href="https://fluffy.es/facebook-draggable-bottom-card-modal-2/" target="_self">https://fluffy.es/facebook-draggable-bottom-card-modal-2/</a>)</p></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html#드래그가_가능한_BottomSheet를_만들어보자(DraggableBottomSheet_)_0" data-path="#드래그가_가능한_BottomSheet를_만들어보자(DraggableBottomSheet_)_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )">드래그가 가능한 BottomSheet를 만들어보자(DraggableBottomSheet )</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html#들어가기_전에_0" data-path="#들어가기_전에_0"><div class="tree-item-inner heading-link" heading-name="들어가기 전에">들어가기 전에</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html#구현_0" data-path="#구현_0"><div class="tree-item-inner heading-link" heading-name="구현">구현</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="ios/드래그가-가능한-bottomsheet를-만들어보자(draggablebottomsheet-).html#전체코드_및_레퍼런스_0" data-path="#전체코드_및_레퍼런스_0"><div class="tree-item-inner heading-link" heading-name="전체코드 및 레퍼런스">전체코드 및 레퍼런스</div></a><div class="tree-item-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></body></html>